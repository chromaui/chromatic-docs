---
layout: "../../layouts/Layout.astro"
title: Cypress (beta)
description: Chromatic E2E Visual Tests capture snapshots of pages visited during Cypress tests.
sidebar: { order: 18 }
---

import { TabItem, Tabs } from '../../components/Tabs'

# E2E Visual Tests for Cypress (beta)
Chromatic E2E Visual Tests lets you bring Chromaticâ€™s visual testing toolkit into your existing Cypress workflow. You can use Chromatic to capture snapshots of pages visited during Cypress testsâ€”including DOM, styles, and assetsâ€”and then review and approve them in the Chromatic UI.

## Getting started

### 1. Initialize your Chromatic project

```bash
npx chromatic init --cypress
```

### 2. Add the following to your `cypress/support/index.js` file:

```js
import 'chromatic-cypress/support';
```

### 3. Install our plugin in your `cypress.config.js` file:

```js
const { defineConfig } = require("cypress");
const { installPlugin } = require('chromatic-cypress');

module.exports = defineConfig({
  e2e: {
    setupNodeEvents(on, config) {
      installPlugin(on);
    },
  },
});
```

### 4. Run Cypress as usual, prepending your command with the following environment variable, which defines what port Chrome Devtools Protocol should listen to:

Any port is fine, as long as it's not already in use. We recommend using `9222`.
<Tabs>
  <TabItem label="yarn">
    ```shell
    ELECTRON_EXTRA_LAUNCH_ARGS=--remote-debugging-port=<a-port-number> yarn cypress run
    ```
  </TabItem>
  <TabItem label="npm">
    ```shell
    ELECTRON_EXTRA_LAUNCH_ARGS=--remote-debugging-port=<a-port-number> npx cypress run
    ```
  </TabItem>
</Tabs>

### 5. Then run a Chromatic build through the CLI:

<Tabs>
  <TabItem label="yarn">
    ```shell
    yarn chromatic --cypress
    ```
  </TabItem>
  <TabItem label="npm">
    ```shell
    npm run chromatic --cypress
    ```
  </TabItem>
</Tabs>

### 6. Prepend build scripts with the Cypress-managed downloads folder:

```json
"scripts": {
  "archive-storybook": "CHROMATIC_ARCHIVE_LOCATION=./cypress/downloads archive-storybook",
  "build-archive-storybook": "CHROMATIC_ARCHIVE_LOCATION=./cypress/downloads build-archive-storybook"
}
```

## Taking manual snapshots

A snapshot is automatically taken at the end of every test, whether is passes or fails. But you can also programmatically take manual snapshots at specific points in your tests using the `takeSnapshot` function inside your test runs:

```js
describe('My First Test', () => {
  it('Visits the Kitchen Sink', () => {
    // ðŸ‘‡ navigate to target page
    cy.visit('https://example.cypress.io')

    // ðŸ“¸ tell Chromatic to take a snapshot of the initial page state
		cy.takeSnapshot()

    // ðŸ‘‡ finish the test by opening the dropdown menu
    cy.get('.dropdown:first-of-type > .dropdown-toggle').click()

    // ðŸ“¸ Chromatic automatically takes a snapshot here, at the end of the test
  })
})
```

### Environment variables

Some options can be configured through environment variables.

| Environment variable         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ---------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `CHROMATIC_ARCHIVE_LOCATION` | If you have configured your project's [`downloadsFolder`](https://docs.cypress.io/guides/references/configuration#Downloads) option to be different than the default, you must set the `CHROMATIC_ARCHIVE_LOCATION` environment variable to the same value. This must be done when starting the Storybook and when building it on CI. This ensures that the Archive Storybook can find the [archives](#what-are-archives) generated by the Test Archiver. |